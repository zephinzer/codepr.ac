stages:
  - initialise
  - publish
image: node:lts-alpine

install dependencies:
  stage: initialise
  cache:
    untracked: true
    policy: pull-push
    paths:
      - ./node_modules
      - ./vendor
  artifacts:
    expire_in: 1 week
    paths: [node_modules]
  script:
    - npm ci

pages:
  stage: publish
  dependencies: [install dependencies]
  artifacts:
    paths: [public]
  script:
    - npm run build
    # these are for gitlab pages, see https://gitlab.com/gitlab-org/gitlab-foss/-/issues/40686
    - rm -rf ./public
    - mv build public
